<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebOS</title>
    <link rel="stylesheet" href="index.css">
</head>
<body oncontextmenu="return false">
    <br><br>
    <div id="warning">
        <h1>WebOS is designed for 1080p screens.</h1>
        <p>Your experince with WebOS may not be optimal on screens smaller than 1920x1080</p>
        <button onclick="remove('warning')" style="width: 50px;">Ok</button>
    </div>
    <div class="desktop">
        <figure>
            <img src="img/devices/computer.svg" class="desktopicon" onclick="show('welcome', 'yes')" draggable="false">
            <figcaption>About</figcaption>
        </figure>
    </div>
    <div id="welcome">
        <div id="welcomeheader">Welcome to WebOS! <div class="close" onclick="remove('welcome')"></div></div>
        <br>
        <h1>Welcome to WebOS!</h1>
        <p>WebOS is the ultimate operating system<br>in your web browser!</p>
        <h3>WebOS is currently in beta!</h3>
        <p>Please report bugs on the GitHub!</p>
        <a href="https://github.com/breadteleporter/webos"><p id="github">Github</p></a>
        <p id="agent"></p>
        <p id="vertext">WebOS version beta 0.2</p>
    </div>
    <div id="textedit">
        <div id="texteditheader">TextEdit <div class="close" onclick="remove('textedit')"></div></div>
        <br><br>
        <button onclick="saveTextAsFile(text.value,'file.txt')">Save</button>
        <button id="load">Load</button>
        <textarea id="text" name="text" rows="12" cols="50"></textarea>
    </div>
    <div id="paint">
        <div id="paintheader">Paint <div class="close" onclick="remove('paint')"></div></div>
        <br><br>
        <iframe src="https://jspaint.app"></iframe>
    </div>
    <div id="tetris">
        <div id="tetrisheader">Tetris <div class="close" onclick="remove('tetris')"></div></div>
        <br><br>
        <embed src="apps/tetris.html" style="width: 100%; height: 95%;"></embed>
    </div>
    <div id="calc">
        <div id="calcheader">Calculator <div class="close" onclick="remove('calc')"></div></div>
        <br><br>
        <embed src="apps/calc.html" style="width: 100%; height: 95%;"></embed>
    </div>
    <div class="startmenu" id="startmenu">
        <img src="img/profile.png" width="64" id="profile">
        <p onclick="show('welcome', 'yes')"id="webosstarttext">WebOS</p>
        <p onclick="show('paint', 'yes')">Paint</p>
        <p onclick="show('textedit', 'yes')">TextEdit</p>
        <p onclick="show('tetris', 'yes')">Tetris</p>
        <p onclick="show('calc', 'yes')">Calculator</p>
    </div>
    <div class="taskbar">
        <button id="startbuttonshow" onclick="showstart()">Start</button>
        <button id="startbuttonhide" onclick="hidestart()">Start</button>
    </div>
</body>
<script>

    document.addEventListener("contextmenu", function (e) {
        e.preventDefault();
    }, false);
    // This is a dumb solution, but it works so I dont care.
    function showstart(){
        show("startmenu", "no")
        remove("startbuttonshow")
        show("startbuttonhide", "no")
    }
    function hidestart(){
        remove("startmenu")
        show("startbuttonshow", "no")
        remove("startbuttonhide")
    }
    function readSingleFile(evt) {
        //Retrieve the first (and only!) File from the FileList object
        var f = evt.target.files[0];

        if (f) {
            var r = new FileReader();
            r.onload = function (e) {
                var contents = e.target.result;
                document.getElementById("ReadResult").innerHTML = contents;
            }
            r.readAsText(f);
            } else {
            alert("Failed to load file");
            }
        }

    document.getElementById('load').addEventListener('change', readSingleFile, false);
    let agent = navigator.userAgent
    document.getElementById("agent").innerHTML = agent
    function show(id, start){
        if (start == "yes"){
            hidestart()
        }
        document.getElementById(id).style = "display: block;"
    }
    function remove(id){
        document.getElementById(id).style = "display: none;"
    }
    // Make the DIV element draggable:
    dragElement(document.getElementById("welcome"));
    dragElement(document.getElementById("textedit"));
    dragElement(document.getElementById("paint"));
    dragElement(document.getElementById("tetris"));
    dragElement(document.getElementById("calc"));

    function dragElement(elmnt) {
    var pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
    if (document.getElementById(elmnt.id + "header")) {
        // if present, the header is where you move the DIV from:
        document.getElementById(elmnt.id + "header").onmousedown = dragMouseDown;
    } else {
        // otherwise, move the DIV from anywhere inside the DIV:
        elmnt.onmousedown = dragMouseDown;
    }

    function dragMouseDown(e) {
        e = e || window.event;
        e.preventDefault();
        // get the mouse cursor position at startup:
        pos3 = e.clientX;
        pos4 = e.clientY;
        document.onmouseup = closeDragElement;
        // call a function whenever the cursor moves:
        document.onmousemove = elementDrag;
    }

    function elementDrag(e) {
        e = e || window.event;
        e.preventDefault();
        // calculate the new cursor position:
        pos1 = pos3 - e.clientX;
        pos2 = pos4 - e.clientY;
        pos3 = e.clientX;
        pos4 = e.clientY;
        // set the element's new position:
        elmnt.style.top = (elmnt.offsetTop - pos2) + "px";
        elmnt.style.left = (elmnt.offsetLeft - pos1) + "px";
    }

    function closeDragElement() {
        // stop moving when mouse button is released:
        document.onmouseup = null;
        document.onmousemove = null;
    }
    }   
    function saveTextAsFile(textToWrite, fileNameToSaveAs)
    {
    var textFileAsBlob = new Blob([textToWrite], {type:'text/plain'}); 
    var downloadLink = document.createElement("a");
    downloadLink.download = fileNameToSaveAs;
    downloadLink.innerHTML = "Download File";
    if (window.webkitURL != null)
    {
    // Chrome allows the link to be clicked
    // without actually adding it to the DOM.
    downloadLink.href = window.webkitURL.createObjectURL(textFileAsBlob);
    }
    else
    {
    // Firefox requires the link to be added to the DOM
    // before it can be clicked.
    downloadLink.href = window.URL.createObjectURL(textFileAsBlob);
    downloadLink.onclick = destroyClickedElement;
    downloadLink.style.display = "none";
    document.body.appendChild(downloadLink);
    }
    
    downloadLink.click();
    }
</script>
</html>
